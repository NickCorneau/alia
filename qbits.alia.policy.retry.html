<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>qbits.alia.policy.retry documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Alia 1.2.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="qbits.alia.html"><span>qbits.alia</span></a></li><li><a href="qbits.alia.cluster-options.html"><span>qbits.alia.cluster-options</span></a></li><li><a href="qbits.alia.codec.html"><span>qbits.alia.codec</span></a></li><li><a href="qbits.alia.codec.eaio-uuid.html"><span>qbits.alia.codec.eaio-uuid</span></a></li><li><a href="qbits.alia.codec.joda-time.html"><span>qbits.alia.codec.joda-time</span></a></li><li><a href="qbits.alia.enum.html"><span>qbits.alia.enum</span></a></li><li><a href="qbits.alia.policy.load-balancing.html"><span>qbits.alia.policy.load-balancing</span></a></li><li><a href="qbits.alia.policy.reconnection.html"><span>qbits.alia.policy.reconnection</span></a></li><li class="current"><a href="qbits.alia.policy.retry.html"><span>qbits.alia.policy.retry</span></a></li><li><a href="qbits.alia.utils.html"><span>qbits.alia.utils</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="qbits.alia.policy.retry.html#var-default-retry-policy"><span>default-retry-policy</span></a></li><li><a href="qbits.alia.policy.retry.html#var-downgrading-consistency-retry-policy"><span>downgrading-consistency-retry-policy</span></a></li><li><a href="qbits.alia.policy.retry.html#var-fallthrough-retry-policy"><span>fallthrough-retry-policy</span></a></li><li><a href="qbits.alia.policy.retry.html#var-logging-retry-policy"><span>logging-retry-policy</span></a></li><li><a href="qbits.alia.policy.retry.html#var-on-read-timeout"><span>on-read-timeout</span></a></li><li><a href="qbits.alia.policy.retry.html#var-on-unavailable"><span>on-unavailable</span></a></li><li><a href="qbits.alia.policy.retry.html#var-on-write-timeout"><span>on-write-timeout</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>qbits.alia.policy.retry documentation</h2><pre class="doc">A policy that defines a default behavior to adopt when a request returns a
TimeoutException or an UnavailableException. Such policy allows to centralize
the handling of query retries, allowing to minimize the need for exception
catching/handling in business code.</pre><div class="public" id="var-default-retry-policy"><h3>default-retry-policy</h3><div class="usage"></div><pre class="doc">The default retry policy.

This policy retries queries in only two cases:

On a read timeout, if enough replica replied but data was not
retrieved.  On a write timeout, if we timeout while writing the
distributed log used by batch statements.

This retry policy is conservative in that it will never retry with a
different consistency level than the one of the initial operation.

In some cases, it may be convenient to use a more aggressive retry
policy like `downgrading-consistency-retry-policy`

http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/DefaultRetryPolicy.html</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia/policy/retry.clj#L16">Source</a></div></div><div class="public" id="var-downgrading-consistency-retry-policy"><h3>downgrading-consistency-retry-policy</h3><div class="usage"></div><pre class="doc">A retry policy that sometimes retry with a lower consistency level
than the one initially requested.

BEWARE: This policy may retry queries using a lower consistency level
than the one initially requested. By doing so, it may break
consistency guarantees. In other words, if you use this retry policy,
there is cases (documented below) where a read at QUORUM may not see a
preceding write at QUORUM. Do not use this policy unless you have
understood the cases where this can happen and are ok with that. It is
also highly recommended to always wrap this policy into
LoggingRetryPolicy to log the occurrences of such consistency break.

This policy implements the same retries than the DefaultRetryPolicy
policy. But on top of that, it also retries in the following cases:

On a read timeout: if the number of replica that responded is greater
than one but lower than is required by the requested consistency
level, the operation is retried at a lower consistency level.  On a
write timeout: if the operation is an WriteType.UNLOGGED_BATCH and at
least one replica acknowledged the write, the operation is retried at
a lower consistency level.

Furthermore, for other operation, if at least one replica acknowledged
the write, the timeout is ignored.  On an unavailable exception: if at
least one replica is alive, the operation is retried at a lower
consistency level.  The reasoning being this retry policy is the
following one. If, based on the information the Cassandra coordinator
node returns, retrying the operation with the initially requested
consistency has a change to succeed, do it. Otherwise, if based on
these information we know the initially requested consistency level
cannot be achieve currently, then:

For writes, ignore the exception (thus silently failing the
consistency requirement) if we know the write has been persisted on at
least one replica.


For reads, try reading at a lower consistency level (thus silently
failing the consistency requirement).  In other words, this policy
implements the idea that if the requested consistency level cannot be
achieved, the next best thing for writes is to make sure the data is
persisted, and that reading something is better than reading nothing,
even if there is a risk of reading stale data.

http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/DowngradingConsistencyRetryPolicy.html</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia/policy/retry.clj#L44">Source</a></div></div><div class="public" id="var-fallthrough-retry-policy"><h3>fallthrough-retry-policy</h3><div class="usage"></div><pre class="doc">A retry policy that never retry (nor ignore).

All of the methods of this retry policy unconditionally return
RetryPolicy.RetryDecision.rethrow(). If this policy is used, retry
will have to be implemented in business code.

http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/FallthroughRetryPolicy.html</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia/policy/retry.clj#L34">Source</a></div></div><div class="public" id="var-logging-retry-policy"><h3>logging-retry-policy</h3><div class="usage"><code>(logging-retry-policy retry-policy)</code></div><pre class="doc">A retry policy that wraps another policy, logging the decision made by its
sub-policy.

Note that this policy only log the IGNORE and RETRY decisions (since
RETHROW decisions are just meant to propagate the cassandra
exception).

The logging is done at the INFO level.

http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/LoggingRetryPolicy.html</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia/policy/retry.clj#L93">Source</a></div></div><div class="public" id="var-on-read-timeout"><h3>on-read-timeout</h3><div class="usage"><code>(on-read-timeout policy query consistency required-responses received-responses data-retrieved? nb-retry)</code></div><pre class="doc">Defines whether to retry and at which consistency level on a read timeout.
</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia/policy/retry.clj#L107">Source</a></div></div><div class="public" id="var-on-unavailable"><h3>on-unavailable</h3><div class="usage"><code>(on-unavailable policy query consistency required-responses required-replica alive-responses nb-retry)</code></div><pre class="doc">Defines whether to retry and at which consistency level on an unavailable
exception.</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia/policy/retry.clj#L119">Source</a></div></div><div class="public" id="var-on-write-timeout"><h3>on-write-timeout</h3><div class="usage"><code>(on-write-timeout policy query consistency write-type required-acks received-acks nb-retry)</code></div><pre class="doc">Defines whether to retry and at which consistency level on a write timeout
</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia/policy/retry.clj#L131">Source</a></div></div></div></body></html>
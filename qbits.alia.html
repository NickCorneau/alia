<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>qbits.alia documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Alia 2.1.1 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>qbits</span></div></div></li><li class="depth-2 current"><a href="qbits.alia.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>alia</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></div></li><li class="depth-4 branch"><a href="qbits.alia.codec.eaio-uuid.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>eaio-uuid</span></div></a></li><li class="depth-4"><a href="qbits.alia.codec.joda-time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda-time</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>policy</span></div></div></li><li class="depth-4 branch"><a href="qbits.alia.policy.load-balancing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>load-balancing</span></div></a></li><li class="depth-4 branch"><a href="qbits.alia.policy.reconnection.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reconnection</span></div></a></li><li class="depth-4"><a href="qbits.alia.policy.retry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>retry</span></div></a></li><li class="depth-3"><a href="qbits.alia.uuid.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>uuid</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="qbits.alia.html#var-bind"><div class="inner"><span>bind</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-cluster"><div class="inner"><span>cluster</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-connect"><div class="inner"><span>connect</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-execute"><div class="inner"><span>execute</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-execute-async"><div class="inner"><span>execute-async</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-execute-chan"><div class="inner"><span>execute-chan</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-execute-chan-buffered"><div class="inner"><span>execute-chan-buffered</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-lazy-query"><div class="inner"><span>lazy-query</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-prepare"><div class="inner"><span>prepare</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-set-hayt-query-fn.21"><div class="inner"><span>set-hayt-query-fn!</span></div></a></li><li class="depth-1"><a href="qbits.alia.html#var-shutdown"><div class="inner"><span>shutdown</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">qbits.alia</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-bind"><h3>bind</h3><div class="usage"><code>(bind statement values)</code></div><div class="doc"><div class="markdown"><p>Takes a statement and a collection of values and returns a com.datastax.driver.core.BoundStatement instance to be used with <code>execute</code> (or one of its variants)</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L190">view source</a></div></div><div class="public anchor" id="var-cluster"><h3>cluster</h3><div class="usage"><code>(cluster options)</code><code>(cluster)</code></div><div class="doc"><div class="markdown"><p>Takes an option map and returns a new com.datastax.driver.core/Cluster instance.</p><p>The following options are supported:</p>
<ul>
  <li><p><code>:contact-points</code> : List of nodes ip addresses to connect to.</p></li>
  <li><p><code>:port</code> : port to connect to on the nodes (native transport must be  active on the nodes: <code>start_native_transport: true</code> in  cassandra.yaml). Defaults to 9042 if not supplied.</p></li>
  <li><p><code>:load-balancing-policy</code> : Configure the  <a href="http://mpenet.github.io/alia/qbits.alia.policy.load-balancing.html">Load Balancing Policy</a>  to use for the new cluster.</p></li>
  <li><p><code>:reconnection-policy</code> : Configure the  <a href="http://mpenet.github.io/alia/qbits.alia.policy.reconnection.html">Reconnection Policy</a>  to use for the new cluster.</p></li>
  <li><p><code>:retry-policy</code> : Configure the  <a href="http://mpenet.github.io/alia/qbits.alia.policy.retry.html">Retry Policy</a>  to use for the new cluster.</p></li>
  <li><p><code>:metrics?</code> : Toggles metrics collection for the created cluster  (metrics are enabled by default otherwise).</p></li>
  <li><p><code>:jmx-reporting?</code> : Toggles JMX reporting of the metrics.</p></li>
  <li><p><code>:credentials</code> : Takes a map of :user and :password for use with  Cassandra&rsquo;s PasswordAuthenticator</p></li>
  <li><p><code>:compression</code> : Compression supported by the Cassandra binary  protocol. Can be <code>:none</code> or <code>:snappy</code>.</p></li>
  <li><p><code>:ssl?</code>: enables/disables SSL</p></li>
  <li><p><code>:ssl-options</code> : advanced SSL setup using a  <code>com.datastax.driver.core.SSLOptions</code> instance</p></li>
  <li><p><code>:pooling-options</code> : The pooling options used by this builder.  Options related to connection pooling.</p></li>
</ul><p>The driver uses connections in an asynchronous way. Meaning that  multiple requests can be submitted on the same connection at the  same time. This means that the driver only needs to maintain a  relatively small number of connections to each Cassandra host. These  options allow to control how many connections are kept exactly.</p><p>For each host, the driver keeps a core amount of connections open at  all time. If the utilisation of those connections reaches a  configurable threshold ,more connections are created up to a  configurable maximum number of connections.</p><p>Once more than core connections have been created, connections in  excess are reclaimed if the utilisation of opened connections drops  below the configured threshold.</p><p>Each of these parameters can be separately set for <code>:local</code> and <code>:remote</code>  hosts (HostDistance). For <code>:ignored</code> hosts, the default for all those  settings is 0 and cannot be changed.</p><p>Each of the following configuration keys, take a map of {distance value} :  ex:  <code>clojure
  :core-connections-per-host {:remote 10 :local 100}
</code></p>
<ul>
  <li><code>:core-connections-per-host</code> Number</li>
  <li><code>:max-connections-per-host</code> Number</li>
  <li><code>:max-simultaneous-requests-per-connection</code> Number</li>
  <li><code>:min-simultaneous-requests-per-connection</code> Number</li>
  <li><p><code>:socket-options</code>: a map of</p>
  <ul>
    <li><code>:connect-timeout-millis</code> Number</li>
    <li><code>:read-timeout-millis</code> Number</li>
    <li><code>:receive-buffer-size</code> Number</li>
    <li><code>:send-buffer-size</code> Number</li>
    <li><code>:so-linger</code> Number</li>
    <li><code>:tcp-no-delay?</code> Bool</li>
    <li><code>:reuse-address?</code> Bool</li>
    <li><code>:keep-alive?</code> Bool</li>
  </ul></li>
  <li><p><code>:query-options</code>: a map of</p>
  <ul>
    <li><code>:fetch-size</code> Number</li>
    <li><code>:consistency</code> (consistency Keyword)</li>
    <li><code>:serial-consistency</code> (consistency Keyword)</li>
  </ul></li>
  <li><p><code>:jmx-reporting?</code> Bool, enables/disables JMX reporting of the metrics.</p></li>
</ul><p>The handling of these options is achieved with a multimethod that you could extend if you need to handle some special case or want to create your own options templates. See <code>qbits.alia.cluster-options/set-cluster-option!</code> <a href="../src/qbits/alia/cluster_options.clj#L19">source</a></p><p>Values for consistency:</p><p>:all :any :each-quorum :local-one :local-quorum :local-serial :one :quorum :serial :three :two</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L38">view source</a></div></div><div class="public anchor" id="var-connect"><h3>connect</h3><div class="usage"><code>(connect cluster keyspace)</code><code>(connect cluster)</code></div><div class="doc"><div class="markdown"><p>Returns a new com.datastax.driver.core/Session instance. We need to have this separate in order to allow users to connect to multiple keyspaces from a single cluster instance</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L147">view source</a></div></div><div class="public anchor" id="var-execute"><h3>execute</h3><div class="usage"><code>(execute session query {:keys [consistency serial-consistency routing-key retry-policy tracing? string-keys? fetch-size values]})</code><code>(execute session query)</code></div><div class="doc"><div class="markdown"><p>Executes a query against a session. Returns a collection of rows.</p><p>The query can be a raw string, a PreparedStatement (returned by <code>prepare</code>) with values passed via the <code>:values</code> option key will be bound by <code>execute</code>, BoundStatement (returned by <code>qbits.alia/bind</code>), or a Hayt query.</p><p>The following options are supported:</p>
<ul>
  <li><code>:values</code> : values to be bound to a prepared query</li>
  <li><code>:consistency</code> : Keyword, consistency</li>
  <li><code>:serial-consistency</code> : Keyword, consistency</li>
  <li><code>:routing-key</code> : ByteBuffer</li>
  <li><code>:retry-policy</code> : one of qbits.alia.policy.retry/*</li>
  <li><code>:tracing?</code> : Bool, toggles query tracing (available via query result metadata)</li>
  <li><code>:string-keys?</code> : Bool, stringify keys (they are keyword by default)</li>
  <li><code>:fetch-size</code> : Number, sets query fetching size</li>
</ul><p>Values for consistency:</p><p>:all :any :each-quorum :local-one :local-quorum :local-serial :one :quorum :serial :three :two</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L241">view source</a></div></div><div class="public anchor" id="var-execute-async"><h3>execute-async</h3><div class="usage"><code>(execute-async session query {:keys [success error executor consistency serial-consistency routing-key retry-policy tracing? string-keys? fetch-size values]})</code><code>(execute-async session query)</code></div><div class="doc"><div class="markdown"><p>Same as execute, but returns a promise and accepts :success and :error handlers via options, you can also pass :executor via the option map for the ResultFuture, it defaults to a cachedThreadPool if you don&rsquo;t.</p><p>For other options refer to <code>qbits.alia/execute</code> doc</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L278">view source</a></div></div><div class="public anchor" id="var-execute-chan"><h3>execute-chan</h3><div class="usage"><code>(execute-chan session query {:keys [executor consistency serial-consistency routing-key retry-policy tracing? string-keys? fetch-size values]})</code><code>(execute-chan session query)</code></div><div class="doc"><div class="markdown"><p>Same as execute, but returns a clojure.core.async/chan that is wired to the underlying ResultSetFuture. This means this is usable with <code>go</code> blocks or <code>take!</code>. Exceptions are sent to the channel as a value, it&rsquo;s your responsability to handle these how you deem appropriate.</p><p>For options refer to <code>qbits.alia/execute</code> doc</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L313">view source</a></div></div><div class="public anchor" id="var-execute-chan-buffered"><h3>execute-chan-buffered</h3><div class="usage"><code>(execute-chan-buffered session query {:keys [executor consistency serial-consistency routing-key retry-policy tracing? string-keys? fetch-size values channel]})</code><code>(execute-chan-buffered session query)</code></div><div class="doc"><div class="markdown"><p>Allows to execute a query and have rows returned in a <code>clojure.core.async/chan</code>. Every value in the chan is a single row. By default the query <code>:fetch-size</code> inherits from the cluster setting, unless you specify a different <code>:fetch-size</code> at query level and the channel is a regular <code>clojure.core.async/chan</code>, unless you pass your own <code>:channel</code> with its own sizing caracteristics. <code>:fetch-size</code> dicts the chunking of the rows returned, allowing to stream rows into the channel in a controlled manner. If you close the channel the streaming process ends. Exceptions are sent to the channel as a value, it&rsquo;s your responsability to handle these how you deem appropriate. For options refer to <code>qbits.alia/execute</code> doc</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L343">view source</a></div></div><div class="public anchor" id="var-lazy-query"><h3>lazy-query</h3><div class="usage"><code>(lazy-query session query pred opts)</code><code>(lazy-query session query pred)</code></div><div class="doc"><div class="markdown"><p>Takes a session, a query (hayt, raw or prepared) and a query modifier fn (that receives the last query and last chunk and returns a new query or nil). The first chunk will be the original query result, then for each subsequent chunk the query will be the result of last query modified by the modifier fn unless the fn returns nil, which would causes the iteration to stop.</p><p>It also accepts any of <code>execute</code> options.</p><p>ex: (lazy-query session  (select :items (limit 2) (where {:x (int 1)}))  (fn [q coll]  (merge q (where {:si (-&gt; coll last :x inc)})))  {:consistency :quorum :tracing? true})</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L394">view source</a></div></div><div class="public anchor" id="var-prepare"><h3>prepare</h3><div class="usage"><code>(prepare session query)</code></div><div class="doc"><div class="markdown"><p>Takes a session and a query (raw string or hayt) and returns a com.datastax.driver.core.PreparedStatement instance to be used in <code>execute</code> after it&rsquo;s been bound with <code>bind</code>. Hayt query parameter will be compiled with qbits.hayt/-&gt;raw internaly ex: (prepare session (select :foo (where {:bar ?})))</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L172">view source</a></div></div><div class="public anchor" id="var-set-hayt-query-fn.21"><h3>set-hayt-query-fn!</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Sets root value of hayt-query-fn, allowing to control how hayt queries are executed , defaults to LU with a threshold of 100, this is a global var, changing it will impact all threads</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L32">view source</a></div></div><div class="public anchor" id="var-shutdown"><h3>shutdown</h3><div class="usage"><code>(shutdown x)</code></div><div class="doc"><div class="markdown"><p>Shutdowns Session or Cluster instance, clearing the underlying pools/connections</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/src/qbits/alia.clj#L156">view source</a></div></div></div></body></html>
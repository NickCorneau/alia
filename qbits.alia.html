<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>qbits.alia documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Alia 2.0.0-rc2 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span>Namespaces</span></a></h3><ul><li class="current"><a href="qbits.alia.html"><span>qbits.alia</span></a></li><li><a href="qbits.alia.codec.eaio-uuid.html"><span>qbits.alia.codec.eaio-uuid</span></a></li><li><a href="qbits.alia.codec.joda-time.html"><span>qbits.alia.codec.joda-time</span></a></li><li><a href="qbits.alia.policy.load-balancing.html"><span>qbits.alia.policy.load-balancing</span></a></li><li><a href="qbits.alia.policy.reconnection.html"><span>qbits.alia.policy.reconnection</span></a></li><li><a href="qbits.alia.policy.retry.html"><span>qbits.alia.policy.retry</span></a></li><li><a href="qbits.alia.uuid.html"><span>qbits.alia.uuid</span></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span>Public Vars</span></a></h3><ul><li><a href="qbits.alia.html#var-bind"><span>bind</span></a></li><li><a href="qbits.alia.html#var-cluster"><span>cluster</span></a></li><li><a href="qbits.alia.html#var-connect"><span>connect</span></a></li><li><a href="qbits.alia.html#var-execute"><span>execute</span></a></li><li><a href="qbits.alia.html#var-execute-async"><span>execute-async</span></a></li><li><a href="qbits.alia.html#var-execute-chan"><span>execute-chan</span></a></li><li><a href="qbits.alia.html#var-lazy-query"><span>lazy-query</span></a></li><li><a href="qbits.alia.html#var-prepare"><span>prepare</span></a></li><li><a href="qbits.alia.html#var-set-hayt-query-fn.21"><span>set-hayt-query-fn!</span></a></li><li><a href="qbits.alia.html#var-shutdown"><span>shutdown</span></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">qbits.alia documentation</h2><pre class="doc"></pre><div class="public anchor" id="var-bind"><h3>bind</h3><div class="usage"><code>(bind statement values)</code></div><pre class="doc">Takes a statement and a collection of values and returns a
com.datastax.driver.core.BoundStatement instance to be used with
`execute` (or one of its variants)</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L190">Source</a></div></div><div class="public anchor" id="var-cluster"><h3>cluster</h3><div class="usage"><code>(cluster options)</code><code>(cluster)</code></div><pre class="doc">Takes an option map and returns a new
com.datastax.driver.core/Cluster instance.

The following options are supported:

* `:contact-points` : List of nodes ip addresses to connect to.

* `:port` : port to connect to on the nodes (native transport must be
  active on the nodes: `start_native_transport: true` in
  cassandra.yaml). Defaults to 9042 if not supplied.

* `:load-balancing-policy` : Configure the
  [Load Balancing Policy](<a href="http://mpenet.github.io/alia/qbits.alia.policy.load-balancing.html">http://mpenet.github.io/alia/qbits.alia.policy.load-balancing.html</a>)
  to use for the new cluster.

* `:reconnection-policy` : Configure the
  [Reconnection Policy](<a href="http://mpenet.github.io/alia/qbits.alia.policy.reconnection.html">http://mpenet.github.io/alia/qbits.alia.policy.reconnection.html</a>)
  to use for the new cluster.

* `:retry-policy` : Configure the
  [Retry Policy](<a href="http://mpenet.github.io/alia/qbits.alia.policy.retry.html">http://mpenet.github.io/alia/qbits.alia.policy.retry.html</a>)
  to use for the new cluster.

* `:metrics?` : Toggles metrics collection for the created cluster
  (metrics are enabled by default otherwise).

* `:jmx-reporting?` : Toggles JMX reporting of the metrics.

* `:credentials` : Takes a map of :username and :password for use with
  Cassandra&apos;s PasswordAuthenticator

* `:compression` : Compression supported by the Cassandra binary
  protocol. Can be `:none` or `:snappy`.

* `:ssl?`: enables/disables SSL

* `:ssl-options` : advanced SSL setup using a
  `com.datastax.driver.core.SSLOptions` instance

* `:pooling-options` : The pooling options used by this builder.
  Options related to connection pooling.

  The driver uses connections in an asynchronous way. Meaning that
  multiple requests can be submitted on the same connection at the
  same time. This means that the driver only needs to maintain a
  relatively small number of connections to each Cassandra host. These
  options allow to control how many connections are kept exactly.

  For each host, the driver keeps a core amount of connections open at
  all time. If the utilisation of those connections reaches a
  configurable threshold ,more connections are created up to a
  configurable maximum number of connections.

  Once more than core connections have been created, connections in
  excess are reclaimed if the utilisation of opened connections drops
  below the configured threshold.

  Each of these parameters can be separately set for `:local` and `:remote`
  hosts (HostDistance). For `:ignored` hosts, the default for all those
  settings is 0 and cannot be changed.

  Each of the following configuration keys, take a map of {distance value}  :
  ex:
  ```clojure
  :core-connections-per-host {:remote 10 :local 100}
  ```

  + `:core-connections-per-host` Number
  + `:max-connections-per-host` Number
  + `:max-simultaneous-requests-per-connection` Number
  + `:min-simultaneous-requests-per-connection` Number

* `:socket-options`: a map of
  + `:connect-timeout-millis` Number
  + `:read-timeout-millis` Number
  + `:receive-buffer-size` Number
  + `:send-buffer-size` Number
  + `:so-linger` Number
  + `:tcp-no-delay?` Bool
  + `:reuse-address?` Bool
  + `:keep-alive?` Bool

* `:query-options`: a map of
  + `:fetch-size` Number
  + `:consistency` (consistency Keyword)
  + `:serial-consistency` (consistency Keyword)

* `:jmx-reporting?` Bool, enables/disables JMX reporting of the metrics.


The handling of these options is achieved with a multimethod that you
could extend if you need to handle some special case or want to create
your own options templates.
See `qbits.alia.cluster-options/set-cluster-option!` [[source]](../src/qbits/alia/cluster_options.clj#L19)


Values for consistency:

:all :any :each-quorum :local-one :local-quorum :local-serial :one :quorum
:serial :three :two</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L38">Source</a></div></div><div class="public anchor" id="var-connect"><h3>connect</h3><div class="usage"><code>(connect cluster keyspace)</code><code>(connect cluster)</code></div><pre class="doc">Returns a new com.datastax.driver.core/Session instance. We need to
have this separate in order to allow users to connect to multiple
keyspaces from a single cluster instance</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L147">Source</a></div></div><div class="public anchor" id="var-execute"><h3>execute</h3><div class="usage"><code>(execute session query {:keys [consistency serial-consistency routing-key retry-policy tracing? string-keys? fetch-size values]})</code><code>(execute session query)</code></div><pre class="doc">Executes a query against a session.
Returns a collection of rows.

The query can be a raw string, a PreparedStatement (returned by
`prepare`) with values passed via the `:values` option key will be bound by
`execute`, BoundStatement (returned by `qbits.alia/bind`), or a Hayt query.

The following options are supported:

* `:values` : values to be bound to a prepared query
* `:consistency` : Keyword, consistency
* `:serial-consistency` : Keyword, consistency
* `:routing-key` : ByteBuffer
* `:retry-policy` : one of qbits.alia.policy.retry/*
* `:tracing?` : Bool, toggles query tracing (available via query result metadata)
* `:string-keys?` : Bool, stringify keys (they are keyword by default)
* `:fetch-size` : Number, sets query fetching size

Values for consistency:

:all :any :each-quorum :local-one :local-quorum :local-serial :one :quorum
:serial :three :two</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L241">Source</a></div></div><div class="public anchor" id="var-execute-async"><h3>execute-async</h3><div class="usage"><code>(execute-async session query {:keys [success error executor consistency serial-consistency routing-key retry-policy tracing? string-keys? fetch-size values]})</code><code>(execute-async session query)</code></div><pre class="doc">Same as execute, but returns a promise and accepts :success
and :error handlers via options, you can also pass :executor via the
option map for the ResultFuture, it defaults to a cachedThreadPool
if you don&apos;t.

For other options refer to `qbits.alia/execute` doc</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L278">Source</a></div></div><div class="public anchor" id="var-execute-chan"><h3>execute-chan</h3><div class="usage"><code>(execute-chan session query {:keys [executor consistency serial-consistency routing-key retry-policy tracing? string-keys? fetch-size values]})</code><code>(execute-chan session query)</code></div><pre class="doc">Same as execute, but returns a clojure.core.async/chan that is
wired to the underlying ResultSetFuture. This means this is usable
with `go` blocks or `take!`. Exceptions are sent to the channel as a
value, it&apos;s your responsability to handle these how you deem
appropriate.

For options refer to `qbits.alia/execute` doc</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L313">Source</a></div></div><div class="public anchor" id="var-lazy-query"><h3>lazy-query</h3><div class="usage"><code>(lazy-query session query pred opts)</code><code>(lazy-query session query pred)</code></div><pre class="doc">Takes a session, a query (hayt, raw or prepared) and a query modifier fn (that
receives the last query and last chunk and returns a new query or nil).
The first chunk will be the original query result, then for each
subsequent chunk the query will be the result of last query
modified by the modifier fn unless the fn returns nil,
which would causes the iteration to stop.

It also accepts any of `execute` options.

ex: (lazy-query session
                (select :items (limit 2) (where {:x (int 1)}))
                        (fn [q coll]
                          (merge q (where {:si (-&gt; coll last :x inc)})))
                {:consistency :quorum :tracing? true})</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L350">Source</a></div></div><div class="public anchor" id="var-prepare"><h3>prepare</h3><div class="usage"><code>(prepare session query)</code></div><pre class="doc">Takes a session and a query (raw string or hayt) and returns a
com.datastax.driver.core.PreparedStatement instance to be used in
`execute` after it&apos;s been bound with `bind`. Hayt query parameter
will be compiled with qbits.hayt/-&gt;raw internaly
ex: (prepare session (select :foo (where {:bar ?})))</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L172">Source</a></div></div><div class="public anchor" id="var-set-hayt-query-fn.21"><h3>set-hayt-query-fn!</h3><div class="usage"></div><pre class="doc">Sets root value of hayt-query-fn, allowing to control how hayt
queries are executed , defaults to LU with a threshold of 100,
this is a global var, changing it will impact all threads</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L32">Source</a></div></div><div class="public anchor" id="var-shutdown"><h3>shutdown</h3><div class="usage"><code>(shutdown x)</code></div><pre class="doc">Shutdowns Session or Cluster instance, clearing the underlying
pools/connections</pre><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master//home/mpenet/gitmu/alia/src/qbits/alia.clj#L156">Source</a></div></div></div></body></html>